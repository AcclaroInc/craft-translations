{% extends "_layouts/element" %}

{% set saveShortcutRedirect = continueEditingUrl %}
{% set saveSourceAction = 'translations/category/save-draft' %}
{% do view.setIsDeltaRegistrationActive(true) %}

{% set groupHandle = group.handle %}
{% set isNewCategory = category.id ? false : true %}

{% hook "cp.categories.edit" %}

{% block header %}
<div class="flex flex-nowrap">
    {{ block('pageTitle') }}
    {{ block('contextMenu') }}
</div>
<div class="flex">
    {{ block('actionButton') }}
</div>
{% endblock %}

{% block contextMenu %}

<div class="select">
    <select onchange="document.location.href='{{ url('categories/'~groupHandle ~'/'~slug~'?site={locale}') }}'.replace('{locale}', this.value);">
        {% for site in craft.app.sites.getAllSites() %}
        <option value="{{ site.handle }}"{% if site.id == element.site %} selected{% endif %}>{{ site.name }}</option>
        {% endfor %}
    </select>
</div>

{% endblock %}

{% block actionButton %}
<div class="btngroup {{ canEdit ? '' : 'disabled noClick' }}">
    <input type="submit" class="btn submit" value="{{ 'Save'|t('app') }}">
    <div class="btn submit menubtn"></div>
    <div class="menu">
        <ul>
            <ul>
                <li><a class="formsubmit" data-action="translations/category/publish-draft">{{ 'Publish draft'|t }}</a></li>
            </ul>
            <hr>
            <ul>
                <li><a class="formsubmit" data-action="translations/category/delete-draft" data-confirm="{{ 'Are you sure you want to delete this draft?'|t }}">{{ 'Delete draft'|t }}</a></li>
            </ul>
        </ul>
    </div>
</div>
{% endblock %}

{% block content %}
    {{ redirectInput('categories/'~groupHandle) }}
    {{ hiddenInput('groupId', group.id) }}
    {{ hiddenInput('categoryId', category.id) }}
    {{ hiddenInput('draftId', element.draftId) }}
    {{ hiddenInput('site', element.site) }}
    {{ actionInput(saveSourceAction) }}
    {{ csrfInput() }}
    {{ parent() }}

{% endblock %}

{% block details %}

{% if element.id %}
<div class="meta read-only">
    <div class="data">
        <h5 class="heading">{{ "Date Created"|t('app') }}</h5>
        <div class="value">{{ element.dateCreated|datetime('short') }}</div>
    </div>
    <div class="data">
        <h5 class="heading">{{ "Date Updated"|t('app') }}</h5>
        <div class="value">{{ element.dateUpdated|datetime('short') }}</div>
    </div>
</div>
{% endif %}
{% endblock %}
